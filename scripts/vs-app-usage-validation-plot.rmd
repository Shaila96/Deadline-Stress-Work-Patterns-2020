---
title: "Apps Activity"
author: "MD Tanim Hasan"
date: "July 31, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(grid)
library(gridExtra)
library(dplyr)
library(ggpubr)
#install.packages('DataCombine')
library(DataCombine)
library(dplyr)
current_dir <- getwd()
setwd('..')
root_dir <- getwd()
data_dir <- file.path(root_dir, 'curated-data/physiological-data')
data_file_name<-'qc99_all_subj.csv'
```


```{r cars, echo=FALSE}
DF<-read.csv(file.path(data_dir,data_file_name),stringsAsFactors = FALSE)
file_name <- 'Quantitive_All_subject.csv'
DF<-DF[!(DF$Participant_ID=="T005" & DF$Day=="Day4"),]
DF$Day[DF$Day=="Day5"] <- "Day4"
unique(DF$Application)
```

```{r}
DF_Sub1<-subset(DF, Participant_ID=="T007" & DF$Treatment=="WS" & Day=="Day4" & DF$Activities_QC2=="Computer Working" & DF$Reduced_Ontology_One!="SA")
unique(DF_Sub1$Application)
tab_activities <- table(DF_Sub1$Application)
tab_activities

```

```{r}
# DF_Sub1$Application<-as.character(DF_Sub1$Application)
# DF_Sub1$Application[is.na(DF_Sub1$Application)] <- "NA"
# tab_activities <- table(DF_Sub1$Application)
# tab_activities

unique(DF_Sub1$Application)
DF=DF %>% mutate(Modified_App = ifelse(Application == "Microsoft Word" | Application == "Microsoft AutoUpdate" |Application == "Microsoft PowerPoint" | Application == "AdobeAcrobat"| 
                                                   Application == "AdobeReader" | Application == "Emacs-x86_64-10_9" |Application == "EndNote X7"|Application == "Microsoft Excel" |Application == "zotero"|
                                                   Application == "Evernote"| Application == "Preview"|Application == "TextEdit","Document Apps", 
                                ifelse(Application == "Mail"| Application == "Microsoft Outlook", "Email",
                                ifelse(Application=="Google Chrome"| Application=="firefox"|Application=="Safari", "Web Browsing Apps",
                                ifelse(Application=="Photos"| Application=="iTunes"|Application=="Spotify" | Application=="App Store", "Entertaining Apps",
                                ifelse(Application=="Calendar"| Application=="Finder" | Application=="Notes", "Utilities Apps",
                                ifelse(Application=="JavaApplicationStub"| Application=="RStudio" | Application=="Osascript" | Application=="Terminal" | Application=="Console" 
                                                 |Application=="ATLAS.ti" |Application=="TeamViewer", "Programming Apps",
                                ifelse(Application=="QQ"| Application=="Skype" |Application=="FaceTime"| Application=="Slack" |Application=="WeChat"| Application=="Messages"  , "Virtual Communication Apps",
                                ifelse(Application=="Cisco AnyConnect Secure Mobility Client"| Application=="NA", "NA" ,"NA")))))))))
unique(DF$Modified_App)
# title="Day1"
# fig<-Plot2(DF_Sub1,  DF_Sub1$Modified_App,DF_Sub1$Reduced_Ontology_One ,DF_Sub1$Day,DF_Sub1$Participant_ID, title)
fig<-Plot4(DF_Sub1,  DF_Sub1$Modified_App, DF_Sub1$Reduced_Ontology_One, DF_Sub1$Sinterface_Time,DF_Sub1$Participant_ID, title)
fig
```


```{r, echo=FALSE}
Plot1<-function(fun.data, fun.x, Day, SID, title){
p<-ggplot(fun.data, aes(x=fun.x)) + 
  geom_bar(stat="count", width=0.5)+
  theme(axis.text.x = element_text(angle = 30, hjust = 1))+
  ylab("Time [s]")+
  xlab("")+
  labs(title =title )+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_discrete(limits=c("Document Apps", "Web Browsing Apps", "Programming Apps", "Email", "Utilities Apps", "Virtual Communication Apps", "Entertaining Apps", "NA" ))
 print(p)
 
}
```

```{r}
color<- c("R"="green", "W"="blue")
Plot2<-function(data, x, y, S_time, SID, title, y_max){
p<-ggplot(data, aes(x=x, fill=y)) + 
  geom_bar(stat="count", width=0.5)+
  theme(axis.text.x = element_text(angle = 30, hjust = 1))+
  ylab("Time [s]")+
  xlab("")+
  labs(title =title )+
  theme(plot.title = element_text(hjust = 0.5), legend.title = element_blank())+
  scale_x_discrete(limits=c("Document Apps", "Web Browsing Apps", "Programming Apps", "Email", "Utilities Apps", "Virtual Communication Apps", "Entertaining Apps" ))+
  scale_y_continuous(breaks = seq(0,y_max, 2500))+
  expand_limits(y=y_max)+
  scale_fill_manual(values = color, limits = c("R", "W"))
#+coord_flip()
}
```

```{r}
Plot3<-function(fun.data, fun.x, fun.y,Day, SID, title){
p<-ggplot(fun.data, aes(x=fun.x, y=fun.y, fill=fun.y)) + 
  geom_bar(stat="identity", width=0.5)+
  theme(axis.text.x = element_text(angle = 30, hjust = 1))+
  ylab("Time [s]")+
  xlab("")+
  labs(title =title )+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_discrete(limits=c("Document Apps", "Web Browsing Apps", "Programming Apps", "Email", "Utilities Apps", "Virtual Communication Apps", "Entertaining Apps", "NA" ))
 print(p)
 }
```


```{r}
color<- c("R"="green", "W"="blue")
Plot4<-function(data, x, y, S_time, SID, title){
p<-ggplot(data, aes(x=x, fill=y)) + 
  geom_bar(stat="count", width=0.5)+
  theme(axis.text.x = element_text(angle = 30, hjust = 1))+
  ylab("Time [s]")+
  xlab("")+
  labs(title =title )+
  theme(plot.title = element_text(hjust = 0.5))+
  scale_x_discrete(limits=c("Document Apps", "Web Browsing Apps", "Programming Apps", "Email", "Utilities Apps", "Virtual Communication Apps", "Entertaining Apps" ))+
  scale_fill_manual(values = color, limits = c("R", "W"))
}
```


```{r, echo=FALSE}
DF$Application<-as.character(DF$Application)
DF$Application[is.na(DF$Application)] <- "NA"
unique(DF$Application)
DF=DF %>% mutate(Modified_App = ifelse(Application == "Microsoft Word" | Application == "Microsoft AutoUpdate" |Application == "Microsoft PowerPoint" | 
                                    Application == "AdobeReader" | Application == "Emacs-x86_64-10_9" |Application == "EndNote X7"|
                                    Application == "Microsoft Excel" |Application == "Preview","Document Apps", 
                                ifelse(Application == "Mail", "Email",
                                ifelse(Application=="Google Chrome"| Application=="Safari", "Web Browsing Apps",
                                ifelse(Application=="Photos"| Application=="iTunes" | Application=="App Store", "Entertaining Apps",
                                ifelse(Application=="Calendar"| Application=="Finder" | Application=="Notes", "Utilities Apps",
                                ifelse(Application=="JavaApplicationStub"| Application=="RStudio" | Application=="Osascript" | Application=="Terminal" | Application=="Console" |  Application=="TeamViewer", "Programming Apps",
                                ifelse(Application=="QQ"| Application=="Skype" |Application=="FaceTime"| Application=="Slack" |Application=="WeChat"| Application=="Messages"  , "Virtual Communication Apps",
                                ifelse(Application=="Cisco AnyConnect Secure Mobility Client"| Application=="NA", "NA" ,"NA")))))))))
unique(DF$Modified_App)
#write.csv(DF,'Apps.csv')
```

```{r, echo=FALSE}
plot_list<-list()
sid<-factor(DF$Participant_ID)
n=nlevels(sid)
for (i in 1:n) {
  DF_T001<-subset(DF, Participant_ID==levels(sid)[i] & Treatment=="WS" & Activities_QC2=="Computer Working" & Reduced_Ontology_One!="SA" & Reduced_Ontology_One!="SP")
  y_max=max(DF_T001$Sinterface_Time)+100
  
      D_id<-factor(DF_T001$Day)
      m=nlevels(D_id)
      for (j in 1:m) {
        DF_Sub_Day<-subset(DF_T001, Day==levels(D_id)[j])
        title=paste(levels(sid)[i],levels(D_id)[j])
    
        #fig<-Plot2(DF_Sub_Day,  DF_Sub_Day$Modified_App,DF_Sub_Day$Reduced_Ontology_One, DF_S_D$Day,DF_S_D$Participant_ID, title)
        fig<-Plot2(DF_Sub_Day,  DF_Sub_Day$Modified_App, DF_Sub_Day$Reduced_Ontology_One, DF_Sub_Day$Sinterface_Time,DF_Sub_Day$Participant_ID, title, y_max)
        print(fig)
        plot_list[[length(plot_list) + 1]] <- fig

  }
}

ggarrange(plotlist = plot_list, nrow = 2, ncol = 2,common.legend = TRUE, legend="bottom")
```