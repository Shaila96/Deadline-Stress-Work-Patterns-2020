---
title: "Clustering"
output:
  html_document:
    df_print: paged
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(grid)
library(gridExtra)
library(dplyr)
library(ggpubr)
#install.packages('DataCombine')
library(DataCombine)
library(dplyr)
library(reshape2)
library(tidyr)
library(stringr)
library(plyr)
library(ggplot2)
library(dplyr)
library(miceadds)
library(gtools)
library(ggpubr)
library(gvlma)
library(MASS)
library(reshape2)
library(ggcorrplot)
library(GGally)
library(ggnewscale)
library(scales)
library(cowplot)

library(tidyverse)  # data manipulation
library(cluster)    # clustering algorithms
library(factoextra)
```

## Clustering the Subject based on Physiological, Activity and Psychometric Data.

```{r,echo=FALSE}
current_dir <- getwd()
setwd('..')
root_dir <- getwd()
data_dir <- file.path(root_dir, 'curated-data/physiological-data')
#data_file_name<-'qc99_all_subj.csv'
#data_file_name<-'qc1_treatment_mean_v1.csv'
data_file_name<-'qc1_log_trans_mean_v1.csv'
```

```{r, echo=FALSE}
Main_DF<-read.csv(file.path(data_dir,data_file_name),stringsAsFactors = FALSE)
Main_DF<-subset(Main_DF, select = -c(E4_EDA,iWatch_HR ))


Cluster_DF <- data.frame(matrix(ncol = 9, nrow = 9))
x <- c("Participant_ID", "Day1_PP", "Day2_PP", "Day3_PP", "Day4_PP","Day1_HR","Day2_HR", "Day3_HR", "Day4_HR")
colnames(Cluster_DF) <- x

Cluster_DF$Participant_ID<-levels(factor(Main_DF$Participant_ID))
rownames(Cluster_DF)<-Cluster_DF$Participant_ID

Cluster_DF$Participant_ID<-NULL

Day_No<-factor(Main_DF$Day)
numberOfDay=nlevels(Day_No)
      for (j in 1:numberOfDay) {
        
        #Cluster_DF_RB<-subset(Main_DF, Day==levels(Day_No)[j] & Main_DF$Treatment=="RB")
        Cluster_DF_WS<-subset(Main_DF, Day==levels(Day_No)[j] & Main_DF$Treatment=="WS")
        
        
        #Cluster_DF[j]<- Cluster_DF_WS$PP - Cluster_DF_RB$PP
        Cluster_DF[j]<- Cluster_DF_WS$PP
        #Cluster_DF[j+1]<- Cluster_DF_WS$E4_HR - Cluster_DF_RB$E4_HR
        
      }


      for (j in 1:numberOfDay) {
        
        #Cluster_DF_RB<-subset(Main_DF, Day==levels(Day_No)[j] & Main_DF$Treatment=="RB")
        Cluster_DF_WS<-subset(Main_DF, Day==levels(Day_No)[j] & Main_DF$Treatment=="WS")
        #Cluster_DF[j]<- Cluster_DF_WS$PP - Cluster_DF_RB$PP
        #Cluster_DF[j+4]<- Cluster_DF_WS$E4_HR - Cluster_DF_RB$E4_HR
        Cluster_DF[j+4]<- Cluster_DF_WS$E4_HR
      }

Cluster_DF[is.na(Cluster_DF)] <- 0
#Cluster_DF

DF_Bib<-read.csv("C:/Users/soton/Documents/R/DeadlineProject/Questionnaire/@CustomBiographic/Questionnaire Data.csv")

Cluster_DF$Trait_anxiety<- DF_Bib$Trait_anxiety
#Cluster_DF$Personality<- DF_Bib$Personality_AB
```


##  Clustering with PP HR and Trait Anxiety

```{r, echo=FALSE}
k2 <- kmeans(Cluster_DF, centers = 2, nstart = 25)
k3 <- kmeans(Cluster_DF, centers = 3, nstart = 25)
k4 <- kmeans(Cluster_DF, centers = 4, nstart = 25)
#k5 <- kmeans(Cluster_DF, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Cluster_DF) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Cluster_DF) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Cluster_DF) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Cluster_DF, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
      xlab = "",
       ylab="Total within-clusters sum of squares")
avg_sil <- function(k) {
  km.res <- kmeans(Cluster_DF, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Cluster_DF))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```



## Final PP HR and Trait Anxiety
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Cluster_DF, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Cluster_DF)+ggtitle("Cluster using PP-HR-Trait Anxiety k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```




```{r, echo=FALSE}
Cluster_DF$Trait_anxiety<-NULL
Cluster_DF$Agreeableness<- DF_Bib$BFI_.Agreeableness
Cluster_DF$Conscientiousness<- DF_Bib$BFI_.Conscientiousness
Cluster_DF$Extraversion<- DF_Bib$BFI_.Extraversion
Cluster_DF$Neuroticism<- DF_Bib$BFI_.Neuroticism
Cluster_DF$Openness<- DF_Bib$BFI_.Openness
```




##  Clustering with PP HR and BFI

```{r, echo=FALSE}
k2 <- kmeans(Cluster_DF, centers = 2, nstart = 25)
k3 <- kmeans(Cluster_DF, centers = 3, nstart = 25)
k4 <- kmeans(Cluster_DF, centers = 4, nstart = 25)
#k5 <- kmeans(Cluster_DF, centers = 5, nstart = 25)

# plots to compare
# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Cluster_DF) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Cluster_DF) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Cluster_DF) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, ncol = 2, nrow=3)
```





## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Cluster_DF, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
     main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Cluster_DF, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Cluster_DF))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
           #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```


## Final Clustering with PP HR and BFI
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Cluster_DF, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Cluster_DF)+ggtitle("Cluster using PP-HR-BFI k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```


##  Clustering with PP HR Trait Anxiety and BFI

```{r, echo=FALSE}
Cluster_DF$Trait_anxiety<- DF_Bib$Trait_anxiety
#Cluster_DF$Personality<- DF_Bib$Personality_AB
k2 <- kmeans(Cluster_DF, centers = 2, nstart = 25)
k3 <- kmeans(Cluster_DF, centers = 3, nstart = 25)
k4 <- kmeans(Cluster_DF, centers = 4, nstart = 25)
#k5 <- kmeans(Cluster_DF, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Cluster_DF) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Cluster_DF) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Cluster_DF) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Cluster_DF) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Cluster_DF) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, ncol = 2, nrow=3)
```


## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Cluster_DF, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
          main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Cluster_DF, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Cluster_DF))
  mean(ss[, 3])
}
# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
           #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```


##  Final Clustering with PP HR Trait Anxiety and BFI

```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Cluster_DF, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Cluster_DF)+ggtitle("Cluster using PP-Trait-BFI; k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```





```{r, echo=FALSE}
current_dir <- getwd()
setwd('..')
root_dir <- getwd()
data_dir <- file.path(root_dir, 'curated-data/physiological-data')
#data_file_name<-'qc99_all_subj.csv'
data_file_name<-'Activity_Data.csv'

Activity_Data_all<-read.csv(file.path(data_dir,data_file_name),stringsAsFactors = FALSE)


Questionnaire_Data<-read.csv("C:/Users/soton/Documents/R/DeadlineProject/Questionnaire/@EndDay/Data/EndDaySurveyWithResult.csv",stringsAsFactors = FALSE)
```


## Clustering Day1 on PP HR and Activity Data
```{r, echo=FALSE}

Activity_Data_all$Mental<-Questionnaire_Data$Mentally
Activity_Data_all$Physically<-Questionnaire_Data$Physically
Activity_Data_all$Hurried<-Questionnaire_Data$Hurried
Activity_Data_all$Successful<-Questionnaire_Data$Successful
Activity_Data_all$Hard<-Questionnaire_Data$How_Hard
Activity_Data_all$Insecure<-Questionnaire_Data$Insecure

Activity_Data_Day1<-subset(Activity_Data_all, Day=="Day1")

Activity_Data_Day1$PP<- Cluster_DF$Day1_PP
Activity_Data_Day1$HR<- Cluster_DF$Day1_HR

rownames(Activity_Data_Day1)<-Activity_Data_Day1$Participant_ID
Activity_Data_Day1$Participant_ID<-NULL
Activity_Data_Day1$Day<-NULL
```



```{r, echo=FALSE}
k2 <- kmeans(Activity_Data_Day1, centers = 2, nstart = 25)
k3 <- kmeans(Activity_Data_Day1, centers = 3, nstart = 25)
k4 <- kmeans(Activity_Data_Day1, centers = 4, nstart = 25)
#k5 <- kmeans(Activity_Data_Day1, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Activity_Data_Day1) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Activity_Data_Day1) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Activity_Data_Day1) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Activity_Data_Day1) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Activity_Data_Day1) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Activity_Data_Day1) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Activity_Data_Day1) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Activity_Data_Day1, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Activity_Data_Day1, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Activity_Data_Day1))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```



## Final Clustering Day1 on PP HR and Activity Data
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Activity_Data_Day1, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Activity_Data_Day1)+ggtitle("Cluster Day1 using Activity-PP-HR k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```






```{r, echo=FALSE}
Activity_Data_Day2<-subset(Activity_Data_all, Day=="Day2")

Activity_Data_Day2$PP<- Cluster_DF$Day2_PP
Activity_Data_Day2$HR<- Cluster_DF$Day2_HR

rownames(Activity_Data_Day2)<-Activity_Data_Day2$Participant_ID
Activity_Data_Day2$Participant_ID<-NULL
Activity_Data_Day2$Day<-NULL
Activity_Data_Day2$SA<-NULL
```


## Clustering Day2 on PP HR and Activity Data

```{r, echo=FALSE}
k2 <- kmeans(Activity_Data_Day2, centers = 2, nstart = 25)
k3 <- kmeans(Activity_Data_Day2, centers = 3, nstart = 25)
k4 <- kmeans(Activity_Data_Day2, centers = 4, nstart = 25)
#k5 <- kmeans(Activity_Data_Day2, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Activity_Data_Day2) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Activity_Data_Day2) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Activity_Data_Day2) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Activity_Data_Day2) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Activity_Data_Day2) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Activity_Data_Day2) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Activity_Data_Day2) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Activity_Data_Day2, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Activity_Data_Day2, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Activity_Data_Day2))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```



## Final Clustering Day2 on PP HR and Activity Data
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Activity_Data_Day2, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Activity_Data_Day2)+ggtitle("Cluster Day2 using Activity-PP-HR k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```




## Clustering Day3 on PP HR and Activity Data
```{r, echo=FALSE}
Activity_Data_Day3<-subset(Activity_Data_all, Day=="Day3")

Activity_Data_Day3$PP<- Cluster_DF$Day3_PP
Activity_Data_Day3$HR<- Cluster_DF$Day3_HR

rownames(Activity_Data_Day3)<-Activity_Data_Day3$Participant_ID
Activity_Data_Day3$Participant_ID<-NULL
Activity_Data_Day3$Day<-NULL
#Activity_Data_Day2$SA<-NULL
```



```{r, echo=FALSE}
k2 <- kmeans(Activity_Data_Day3, centers = 2, nstart = 25)
k3 <- kmeans(Activity_Data_Day3, centers = 3, nstart = 25)
k4 <- kmeans(Activity_Data_Day3, centers = 4, nstart = 25)
#k5 <- kmeans(Activity_Data_Day3, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Activity_Data_Day3) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Activity_Data_Day3) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Activity_Data_Day3) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Activity_Data_Day3) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Activity_Data_Day3) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Activity_Data_Day3) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Activity_Data_Day3) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Activity_Data_Day3, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Activity_Data_Day3, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Activity_Data_Day3))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```



## Final Clustering Day3 on PP HR and Activity Data
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Activity_Data_Day3, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Activity_Data_Day3)+ggtitle("Cluster Day3 using Activity-PP-HR k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```




## Clustering Day4 on PP HR and Activity Data
```{r, echo=FALSE}
Activity_Data_Day4<-subset(Activity_Data_all, Day=="Day4")

Activity_Data_Day4$PP<- Cluster_DF$Day4_PP
Activity_Data_Day4$HR<- Cluster_DF$Day4_HR

rownames(Activity_Data_Day4)<-Activity_Data_Day4$Participant_ID
Activity_Data_Day4$Participant_ID<-NULL
Activity_Data_Day4$Day<-NULL
Activity_Data_Day4$I<-NULL
```



```{r, echo=FALSE}
k2 <- kmeans(Activity_Data_Day4, centers = 2, nstart = 25)
k3 <- kmeans(Activity_Data_Day4, centers = 3, nstart = 25)
k4 <- kmeans(Activity_Data_Day4, centers = 4, nstart = 25)
#k5 <- kmeans(Activity_Data_Day4, centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Activity_Data_Day4) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Activity_Data_Day4) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Activity_Data_Day4) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Activity_Data_Day4) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Activity_Data_Day4) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Activity_Data_Day4) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Activity_Data_Day4) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Activity_Data_Day4, k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:4

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Activity_Data_Day4, centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Activity_Data_Day4))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:4

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```



## Final Clustering Day4 on PP HR and Activity Data
```{r, echo=FALSE}
set.seed(123)
final <- kmeans(Activity_Data_Day4, 2, nstart = 25)
print(final)
fviz_cluster(final, data = Activity_Data_Day4)+ggtitle("Cluster Day4 using Activity-PP-HR k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
```




```{r, echo=FALSE}
#rownames(Activity_data)<-Activity_data$Participant_ID
Activity_Data_all$PP<-Main_DF$PP
Activity_Data_all$HR<-Main_DF$E4_HR


Activity_Data_all[is.na(Activity_Data_all)] <- 0
```






```{r, echo=FALSE}
k2 <- kmeans(Activity_Data_all[,3:10], centers = 2, nstart = 25)
k3 <- kmeans(Activity_Data_all[,3:10], centers = 3, nstart = 25)
k4 <- kmeans(Activity_Data_all[,3:10], centers = 4, nstart = 25)
#k5 <- kmeans(Activity_Data_all[,3:10], centers = 5, nstart = 25)

# plots to compare
p1 <- fviz_cluster(k2, geom = "point", data = Activity_Data_all[,3:10]) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p2<- fviz_cluster(k2, data = Activity_Data_all[,3:10]) + ggtitle("k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p3 <- fviz_cluster(k3, geom = "point",  data = Activity_Data_all[,3:10]) + ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p4<- fviz_cluster(k3, data = Activity_Data_all[,3:10]) +  ggtitle("k = 3")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p5 <- fviz_cluster(k4, geom = "point",  data = Activity_Data_all[,3:10]) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
p6<- fviz_cluster(k4, data = Activity_Data_all[,3:10]) + ggtitle("k = 4")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))
#p4 <- fviz_cluster(k5, geom = "point",  data = Activity_Data_all[,3:10]) + ggtitle("k = 5")

library(gridExtra)
grid.arrange(p1, p2, p3,p4,p5,p6, nrow=3, ncol = 2)
```



## Determining Optimal Clusters
```{r, echo=FALSE}
set.seed(123)

# function to compute total within-cluster sum of square 
wss <- function(k) {
  kmeans(Activity_Data_all[,3:10], k, nstart = 25 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:5

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE, 
       main="Optimal Clusters using Elbow Method & Average silhouette Method",
       xlab="",
       ylab="Total within-clusters sum of squares")

avg_sil <- function(k) {
  km.res <- kmeans(Activity_Data_all[,3:10], centers = k, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(Activity_Data_all[,3:10]))
  mean(ss[, 3])
}

# Compute and plot wss for k = 2 to k = 15
k.values <- 2:6

# extract avg silhouette for 2-15 clusters
avg_sil_values <- map_dbl(k.values, avg_sil)

plot(k.values, avg_sil_values,
       type = "b", pch = 19, frame = FALSE, 
      #main="Optimal Clusters using  Average silhouette Method",
       xlab = "Number of clusters K",
       ylab = "Average Silhouettes")
```

```{r ,echo=FALSE}
set.seed(123)
final <- kmeans(Activity_Data_all[,3:10], 2, nstart = 25)
print(final)
fviz_cluster(final, data = Activity_Data_all[,3:8])+ggtitle("Cluster All data Activity-PP-HR k = 2")+ xlab("") + ylab("")+theme(plot.title = element_text(hjust = 0.5))

```



```{r}
all_data<-cbind(Activity_Data_Day1, Activity_Data_Day2, Activity_Data_Day3, Activity_Data_Day4)

all_data$Trait_anxiety<-DF_Bib$Trait_anxiety
all_data$Agreeableness<- DF_Bib$BFI_.Agreeableness
all_data$Conscientiousness<- DF_Bib$BFI_.Conscientiousness
all_data$Extraversion<- DF_Bib$BFI_.Extraversion
all_data$Neuroticism<- DF_Bib$BFI_.Neuroticism
all_data$Openness<- DF_Bib$BFI_.Openness
```




```{r}
d <- dist(all_data, method = "euclidean")

hc1 <- hclust(d, method = "complete" )

# Plot the obtained dendrogram
plot(hc1, cex = 0.6, hang = -1)
```

```{r}
distMatrix <- dist(all_data, method="DTW")
hc <- hclust(distMatrix, method="average")
plot(hc, cex = 0.6, hang = -1)
```

