---
title: "Supplementary Plots"
header-includes:
- \usepackage{booktabs}
- \usepackage{sectsty} \sectionfont{\centering}
output:
  pdf_document: default
  html_document: default
geometry: top=3.5cm, bottom=3cm
---




```{r echo = FALSE, warning = FALSE, message = FALSE, results='hide'} 
#-------------------------#
#--------LIBRARIES--------#
#-------------------------#


library(dplyr) # Some problem occured for loading the dplyr package at the beginning




#-------------------------#
#-----GLOBAL VARIABLES----#
#-------------------------#
## CHANGE this path if needed
source(file.path(getwd(), 'us-common-functions.R'))
project_dir <- dirname(getwd())
setwd(project_dir)

``` 

\newpage
```{r echo=FALSE, warning = FALSE, message = FALSE}
#-------------------------#
#-----   FUNCTIONS    ----#
#-------------------------#
merge_data <- function() {
  physiological_data_path <- file.path(project_dir, curated_data_dir, physiological_data_dir)
  
  qc0_df <- custom_read_csv(file.path(physiological_data_path, qc0_final_file_name)) %>% 
    select(Participant_ID, Day, Treatment, TreatmentTime, Raw_PP, Raw_E4_EDA)
    
  
  ############################################################################################
  #                             This might be QC1 or QC2
  ############################################################################################
  qc_df <- custom_read_csv(file.path(physiological_data_path, qc1_file_name)) %>% 
    select(TreatmentTime, PP, E4_HR, E4_EDA, iWatch_HR, Mask)
    
  transformed_df <- custom_read_csv(file.path(physiological_data_path, qc1_transformed_file_name)) %>% 
    select(TreatmentTime, PP, E4_HR, E4_EDA, iWatch_HR) %>% 
    dplyr::rename(
      Trans_PP=PP,
      Trans_E4_HR=E4_HR,
      Trans_E4_EDA=E4_EDA,
      Trans_iWatch_HR=iWatch_HR
    )
  ############################################################################################
    
  full_df <- transformed_df %>%   
    merge(qc0_df, by='TreatmentTime', all=T) %>% 
    merge(qc_df, by='TreatmentTime', all=T) %>%
    select(
      Participant_ID,
      Day,
      Treatment,
      TreatmentTime,

      Raw_PP,
      PP,
      Trans_PP,

      Raw_E4_EDA,
      E4_EDA,
      Trans_E4_EDA,

      E4_HR,
      Trans_E4_HR,

      iWatch_HR,
      Trans_iWatch_HR,

      Mask
    )
  
  print_msg(colnames(full_df))
  convert_to_csv(full_df, file.path(physiological_data_path, full_df_file_name))
}

read_data <- function() {
  full_df <<- custom_read_csv(file.path(project_dir, curated_data_dir, physiological_data_dir, full_df_file_name))
  # print_msg(colnames(full_df))
}


# Participant_ID, Day, Treatment, TreatmentTime,  
# Raw_PP, PP, Trans_PP,  
# Raw_E4_EDA, E4_EDA, Trans_E4_EDA,  
# E4_HR, Trans_E4_HR,  
# iWatch_HR, Trans_iWatch_HR,  Mask
get_signal_data <- function(signal) {
  if (signal=='PP') {
    signal_df <-full_df %>% 
      select(Participant_ID, Day, Treatment, TreatmentTime, Raw_PP, PP, Trans_PP)
  } else if (signal=='E4_EDA') {
    signal_df <-full_df %>% 
      select(Participant_ID, Day, Treatment, TreatmentTime, Raw_E4_EDA, E4_EDA, Trans_E4_EDA)
  } else if (signal=='E4_HR') {
    signal_df <-full_df %>% 
      select(Participant_ID, Day, Treatment, TreatmentTime, E4_HR, Trans_E4_HR)
  } else if (signal=='iWatch_HR') {
    signal_df <-full_df %>% 
      select(Participant_ID, Day, Treatment, TreatmentTime, iWatch_HR, Trans_iWatch_HR)
  }

  signal_df
}


draw_signal_plots <- function(signal_df, signal) {
  for (subj in unique(signal_df$Participant_ID)) {
    subj_df <- signal_df %>% filter(Participant_ID==subj)
    
    for (day in unique(subj_df$Day)) {
      day_df <- subj_df %>% filter(Day==day) 
      
      for (treatment in unique(day_df$Treatment)) {
        treatment_df <- day_df %>% filter(Day==day) 
        
        print(paste(subj, day, treatment))
        
        
        
      }
    }
  }
}

draw_plots <- function() {
  signal_list <- c('PP', 'E4_HR', 'E4_EDA', 'iWatch_HR')

  for (signal in signal_list) {
    signal_df <- get_signal_data(signal)
    # print_msg(colnames(signal_df))
    draw_signal_plots(signal_df, signal)
  }
}
```




\newpage
```{r echo=FALSE, warning = FALSE, message = FALSE}
### merge_data()
read_data()
```



\newpage
<!-- Plots -->
------------------------------
```{r echo=FALSE, warning = FALSE, message = FALSE}
draw_plots()
```

